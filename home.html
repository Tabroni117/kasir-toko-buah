<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>TOKO BUAH INDONESIA ‚Äì Aplikasi Kasir</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <!-- Font & Style -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; margin: 0; padding: 0; background-color: #f0f8ff; font-size: 14px; }
    #layout-header, #layout-footer { width: 100%; }
    .running-text { background: #cce7ff; color: #2196F3; text-align: center; font-weight: bold; padding: 5px 0; }
    .running-text span { display: inline-block; padding-left: 100%; animation: marquee 12s linear infinite; white-space: nowrap; }
    @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }
    #main-content { padding: 16px; padding-bottom: 80px; }
    /* Tambahan style akan otomatis terisi dari layoutheadernavigator.html */
  </style>
</head>
<body>

<!-- Layout Header -->
<div id="layout-header"></div>

<!-- Running Text -->
<div class="running-text"><span>RUJAK BUAH INDONESIA</span></div>

<!-- Konten Utama -->
<div id="main-content">
  <!-- FORM INPUT BUAH -->
  <form id="formBuah">
    <label>Pilih Buah
      <select id="nama"></select>
    </label><br>
    <label>Harga Satuan (Rp)
      <input type="number" id="harga" placeholder="Harga Otomatis" readonly>
    </label><br>
    <label>Jumlah
      <input type="number" id="jumlah">
    </label><br>

    <!-- Custom Rujak -->
    <div id="customMenu" style="display:none;">
      <label>Pilih Sambal
        <select id="sambal">
          <option value="">- Pilih Sambal -</option>
          <option value="Tidak Pedas">Tidak Pedas</option>
          <option value="Pedas">Pedas</option>
          <option value="Extra Pedas">Extra Pedas</option>
        </select>
      </label><br>
      <label>Pilih Ukuran
        <select id="ukuran">
          <option value="">- Pilih Ukuran -</option>
          <option value="500 ml">500 ml</option>
          <option value="650 ml">650 ml</option>
          <option value="750 ml">750 ml</option>
          <option value="1000 ml">1000 ml</option>
        </select>
      </label><br>
      <label>Pilih Bumbu
        <select id="bumbu">
          <option value="">- Pilih Bumbu -</option>
          <option value="Tanpa Kacang">Tanpa Kacang</option>
          <option value="Pakai Kacang">Pakai Kacang</option>
        </select>
      </label><br>
    </div>

    <button type="button" onclick="tambahItem()">üõí Tambah ke Keranjang</button>
  </form>

  <!-- TABEL BELANJA -->
  <h3>üõçÔ∏è Daftar Belanja</h3>
  <div style="overflow-x:auto;">
    <table border="1" width="100%">
      <thead>
        <tr>
          <th>Nama</th>
          <th>Harga</th>
          <th>Jumlah</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody id="tabelBelanja"></tbody>
      <tfoot>
        <tr>
          <td colspan="3"><strong>Total</strong></td>
          <td id="totalBelanja">Rp 0</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <br>
  <button onclick="tampilkanNota()">‚úÖ Checkout</button>

  <!-- Nota Digital -->
  <div id="notaDigital" style="display:none; background:white; border:1px solid #ccc; padding:16px; margin-top:16px;">
    <h3>üßæ Nota Pembayaran</h3>
    <div id="tanggalNota"></div>
    <div id="isiNota" style="margin-top:10px;"></div>
    <strong>Total: <span id="totalNota"></span></strong><br><br>
    <button onclick="window.print()">üñ®Ô∏è Cetak</button>
    <button onclick="alert('Nota telah dikirim ke email Anda.')">‚úâÔ∏è Kirim Email</button>
    <button onclick="closeNota()">‚ùå Tutup Nota</button>
  </div>
</div>

<!-- Layout Footer -->
<div id="layout-footer"></div>

<!-- Firebase & Script -->
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCeqHW_m9kru2vmEDVSoelZ3UWFD4k4Xqc",
    authDomain: "tokobuahkasir.firebaseapp.com",
    projectId: "tokobuahkasir"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let keranjang = [];
  const selectNama = document.getElementById("nama");
  const inputHarga = document.getElementById("harga");

  db.collection("buah").get().then(snapshot => {
    selectNama.innerHTML = '<option value="">-- Pilih Buah --</option>';
    snapshot.forEach(doc => {
      const data = doc.data();
      const option = document.createElement("option");
      option.value = data.nama;
      option.textContent = data.nama;
      option.setAttribute("data-harga", data.harga);
      selectNama.appendChild(option);
    });
  });

  selectNama.addEventListener("change", () => {
    const selected = selectNama.options[selectNama.selectedIndex];
    inputHarga.value = selected.getAttribute("data-harga") || '';
    const nama = selected.value.toLowerCase();
    document.getElementById("customMenu").style.display = nama.includes("rujak") ? "block" : "none";
  });

  function tambahItem() {
    const nama = selectNama.value;
    const harga = parseInt(inputHarga.value);
    const jumlah = parseInt(document.getElementById("jumlah").value);
    const sambal = document.getElementById("sambal").value;
    const ukuran = document.getElementById("ukuran").value;
    const bumbu = document.getElementById("bumbu").value;

    if (!nama || !harga || !jumlah) return alert("Isi semua field.");
    if (document.getElementById("customMenu").style.display === "block" &&
        (!sambal || !ukuran || !bumbu)) return alert("Lengkapi opsi rujak.");

    keranjang.push({ nama, harga, jumlah, sambal, ukuran, bumbu });
    updateTabel();
    document.getElementById("formBuah").reset();
    document.getElementById("customMenu").style.display = "none";
  }

  function updateTabel() {
    const tbody = document.getElementById("tabelBelanja");
    tbody.innerHTML = "";
    let total = 0;
    keranjang.forEach(item => {
      const subtotal = item.harga * item.jumlah;
      total += subtotal;
      tbody.innerHTML += `
        <tr>
          <td>${item.nama}<br><small>${item.sambal}, ${item.ukuran}, ${item.bumbu}</small></td>
          <td>Rp ${item.harga.toLocaleString()}</td>
          <td>${item.jumlah}</td>
          <td>Rp ${subtotal.toLocaleString()}</td>
        </tr>`;
    });
    document.getElementById("totalBelanja").textContent = "Rp " + total.toLocaleString();
  }

  function tampilkanNota() {
    if (keranjang.length === 0) return alert("Keranjang kosong.");
    document.getElementById("notaDigital").style.display = "block";
    const now = new Date();
    document.getElementById("tanggalNota").textContent = now.toLocaleString();
    let isi = "";
    let total = 0;
    keranjang.forEach(item => {
      const subtotal = item.harga * item.jumlah;
      total += subtotal;
      isi += `<div style="margin-bottom:8px;">
                ${item.nama} (${item.jumlah} x Rp ${item.harga.toLocaleString()})<br>
                <small>${item.sambal}, ${item.ukuran}, ${item.bumbu}</small>
              </div><hr>`;
    });
    document.getElementById("isiNota").innerHTML = isi;
    document.getElementById("totalNota").textContent = "Rp " + total.toLocaleString();

    db.collection("pesanan").add({
      waktu: now,
      total: total,
      items: keranjang
    });
  }

  function closeNota() {
    document.getElementById("notaDigital").style.display = "none";
  }

  // Sisipkan layout header/footer
  function loadLayout() {
    fetch("layoutheadernavigator.html").then(res => res.text()).then(html => {
      const doc = new DOMParser().parseFromString(html, "text/html");
      document.getElementById("layout-header").innerHTML = doc.getElementById("layout-header").innerHTML;
      document.getElementById("layout-footer").innerHTML = doc.getElementById("layout-footer").innerHTML;
    });
  }
  document.addEventListener("DOMContentLoaded", loadLayout);
</script>

</body>
</html>
