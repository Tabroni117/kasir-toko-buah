<!DOCTYPE html>
<html lang="id">
<head>
    <!-- Head content remains the same -->
</head>
<body>
    <!-- Rest of your HTML remains the same -->

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCeqHW_m9kru2vmEDVSoelZ3UWFD4k4Xqc",
            authDomain: "tokobuahkasir.firebaseapp.com",
            projectId: "tokobuahkasir",
            storageBucket: "tokobuahkasir.appspot.com",
            messagingSenderId: "731011133713",
            appId: "1:731011133713:web:4247ae627401a01b8c1cb0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Format currency function
        const formatCurrency = (value) => {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(value);
        };

        // Form submission handler
        document.getElementById('fruitForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form values
            const namaBuah = document.getElementById('fruitName').value;
            const harga = parseFloat(document.getElementById('fruitPrice').value);
            const stok = parseInt(document.getElementById('fruitStock').value);
            const timestamp = firebase.firestore.FieldValue.serverTimestamp();
            
            // Validate input
            if (!namaBuah || isNaN(harga) || isNaN(stok)) {
                alert('Harap isi semua field dengan benar!');
                return;
            }
            
            // Show loading state
            document.getElementById('btnTambah').disabled = true;
            document.getElementById('spinner').style.display = 'inline-block';
            
            // Save to Firestore
            db.collection("buah").add({
                nama: namaBuah,
                harga: harga,
                stok: stok,
                createdAt: timestamp,
                updatedAt: timestamp
            })
            .then(() => {
                // Success
                document.getElementById('fruitForm').reset();
                document.getElementById('notifText').textContent = "✔️ Data berhasil disimpan!";
                document.getElementById('notif').style.display = "block";
                document.getElementById('btnLanjut').style.display = "inline-block";
                
                // Refresh the list
                loadFruits();
            })
            .catch((error) => {
                console.error("Error adding document: ", error);
                alert("Terjadi kesalahan saat menyimpan data: " + error.message);
            })
            .finally(() => {
                document.getElementById('btnTambah').disabled = false;
                document.getElementById('spinner').style.display = 'none';
            });
        });

        // Load fruits data
        function loadFruits() {
            db.collection("buah").orderBy("nama").get()
            .then((querySnapshot) => {
                const fruitList = document.getElementById('fruitList');
                fruitList.innerHTML = '';
                
                if (querySnapshot.empty) {
                    fruitList.innerHTML = '<tr><td colspan="5" class="text-center">Tidak ada data buah</td></tr>';
                    return;
                }
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    fruitList.innerHTML += `
                        <tr>
                            <td>${data.nama}</td>
                            <td>${formatCurrency(data.harga)}</td>
                            <td>${data.stok} kg</td>
                            <td><span class="${data.stok > 0 ? 'badge-available' : 'badge-out'}">
                                ${data.stok > 0 ? 'Tersedia' : 'Habis'}
                            </span></td>
                            <td>
                                <button class="action-btn edit-btn" onclick="editFruit('${doc.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteFruit('${doc.id}')">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            });
        }

        // Delete function
        function deleteFruit(id) {
            if (confirm("Apakah Anda yakin ingin menghapus data ini?")) {
                db.collection("buah").doc(id).delete()
                .then(() => {
                    alert("Data berhasil dihapus!");
                    loadFruits();
                })
                .catch((error) => {
                    alert("Gagal menghapus data: " + error.message);
                });
            }
        }

        // Initial load
        document.addEventListener('DOMContentLoaded', () => {
            loadFruits();
        });
    </script>
</body>
</html>
