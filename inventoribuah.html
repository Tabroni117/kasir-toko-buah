<!DOCTYPE html>
<html lang="id">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
Â  <title>RUJAK BUAH INDONESIA | Inventori Buah</title>
Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
Â  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
Â  <style>
Â  Â  :root {
Â  Â  Â  --primary: #16a34a;
Â  Â  Â  --primary-light: #22c55e;
Â  Â  Â  --primary-dark: #15803d;
Â  Â  Â  --white: #ffffff;
Â  Â  Â  --dark: #1e293b;
Â  Â  Â  --card-shadow: 0 5px 8px -3px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.05);
Â  Â  }

Â  Â  * {
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  box-sizing: border-box;
Â  Â  Â  font-family: 'Poppins', sans-serif;
Â  Â  }

Â  Â  body {
Â  Â  Â  background: #f8fafc;
Â  Â  Â  color: var(--dark);
Â  Â  Â  padding: 10px;
Â  Â  Â  padding-bottom: 70px; /* Padding bawah untuk menghindari konten tertutup navigasi */
Â  Â  Â  overflow-x: hidden; /* Mencegah scrolling horizontal */
Â  Â  Â  width: 100%; /* Memastikan lebar body 100% */
Â  Â  }

Â  Â  .container {
Â  Â  Â  max-width: 700px;
Â  Â  Â  width: 100%; /* Memastikan kontainer tidak lebih lebar dari layar */
Â  Â  Â  margin: 0 auto;
Â  Â  Â  background: white;
Â  Â  Â  padding: 15px;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  box-shadow: var(--card-shadow);
Â  Â  }

Â  Â  .header-top {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: center;
Â  Â  Â  margin-bottom: 15px;
Â  Â  }

Â  Â  .header-top button {
Â  Â  Â  font-size: 12px;
Â  Â  Â  padding: 5px 10px;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  border: none;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: background 0.3s, color 0.3s;
Â  Â  }

Â  Â  .back-btn {
Â  Â  Â  background: var(--primary);
Â  Â  Â  color: white;
Â  Â  }

Â  Â  .back-btn:hover {
Â  Â  Â  background: var(--primary-light);
Â  Â  }

Â  Â  .refresh-btn {
Â  Â  Â  border: 1px solid var(--primary);
Â  Â  Â  color: var(--primary);
Â  Â  Â  background: white;
Â  Â  }

Â  Â  .refresh-btn:hover {
Â  Â  Â  background: var(--primary-light);
Â  Â  Â  color: white;
Â  Â  }

Â  Â  .judul {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 6px;
Â  Â  Â  font-size: 14px;
Â  Â  Â  color: var(--primary);
Â  Â  Â  margin-bottom: 10px;
Â  Â  }

Â  Â  .judul i {
Â  Â  Â  font-size: 18px;
Â  Â  }

Â  Â  h2.section-title {
Â  Â  Â  font-size: 14px;
Â  Â  Â  color: var(--primary-dark);
Â  Â  Â  margin-bottom: 1rem;
Â  Â  }

Â  Â  label, input {
Â  Â  Â  font-size: 12px;
Â  Â  }

Â  Â  .form-group {
Â  Â  Â  margin-bottom: 12px;
Â  Â  }

Â  Â  .form-input {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 8px 12px;
Â  Â  Â  border: 1px solid rgba(16, 181, 129, 0.3);
Â  Â  Â  border-radius: 6px;
Â  Â  Â  background: #f8fafc;
Â  Â  Â  font-size: 12px;
Â  Â  }

Â  Â  .btn {
Â  Â  Â  font-size: 12px;
Â  Â  Â  padding: 8px 12px;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  border: none;
Â  Â  Â  cursor: pointer;
Â  Â  }

Â  Â  .btn-primary {
Â  Â  Â  background: var(--primary);
Â  Â  Â  color: white;
Â  Â  }

Â  Â  .btn-secondary {
Â  Â  Â  background: white;
Â  Â  Â  color: var(--primary);
Â  Â  Â  border: 1px solid var(--primary);
Â  Â  }

Â  Â  .btn-group {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 10px;
Â  Â  }

Â  Â  .data-table {
Â  Â  Â  width: 100%;
Â  Â  Â  border-collapse: collapse;
Â  Â  Â  margin-top: 1rem;
Â  Â  Â  font-size: 12px;
Â  Â  Â  table-layout: fixed;
Â  Â  Â  word-wrap: break-word;
Â  Â  }

Â  Â  .data-table th {
Â  Â  Â  padding: 10px;
Â  Â  Â  border-bottom: 1px solid #e2e8f0;
Â  Â  Â  text-align: left;
Â  Â  Â  vertical-align: top;
Â  Â  }
Â  Â  .data-table td {
Â  Â  Â  padding: 10px;
Â  Â  Â  border-bottom: 1px solid #e2e8f0;
Â  Â  Â  vertical-align: middle;
Â  Â  }

Â  Â  .status-badge {
Â  Â  Â  padding: 2px 6px;
Â  Â  Â  border-radius: 20px;
Â  Â  Â  font-size: 9px;
Â  Â  Â  background: #e0fce2;
Â  Â  Â  color: var(--primary-dark);
Â  Â  Â  display: inline-block;
Â  Â  Â  white-space: nowrap;
Â  Â  }

Â  Â  /* âœ… Navigasi bawah tetap di tempat */
Â  Â  .app-nav {
Â  Â  Â  position: fixed;
Â  Â  Â  bottom: 0;
Â  Â  Â  left: 0;
Â  Â  Â  right: 0;
Â  Â  Â  height: 60px;
Â  Â  Â  background: var(--white);
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: center;
Â  Â  Â  padding: 0.3rem 0;
Â  Â  Â  z-index: 100;
Â  Â  Â  border-top: 1px solid #e5e7eb;
Â  Â  }

Â  Â  .nav-btn {
Â  Â  Â  flex: 1;
Â  Â  Â  text-align: center;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  text-decoration: none;
Â  Â  Â  font-size: 0.6rem;
Â  Â  Â  color: var(--primary);
Â  Â  Â  padding: 0.3rem 0;
Â  Â  Â  transition: background 0.3s ease;
Â  Â  }

Â  Â  .nav-btn i {
Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  margin-bottom: 2px;
Â  Â  }

Â  Â  .nav-btn.active {
Â  Â  Â  color: var(--primary);
Â  Â  Â  background: none;
Â  Â  Â  border-radius: 0;
Â  Â  Â  transform: none;
Â  Â  Â  padding: 0.3rem 0;
Â  Â  Â  box-shadow: none;
Â  Â  }

Â  Â  /* Spinner loading */
Â  Â  #loadingSpinner {
Â  Â  Â  display: none;
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0; left: 0; right: 0; bottom: 0;
Â  Â  Â  background: rgba(255, 255, 255, 0.8);
Â  Â  Â  z-index: 999;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  }

Â  Â  .spinner {
Â  Â  Â  width: 3rem;
Â  Â  Â  height: 3rem;
Â  Â  Â  border: 4px solid rgba(16, 185, 129, 0.2);
Â  Â  Â  border-top: 4px solid var(--primary);
Â  Â  Â  border-radius: 50%;
Â  Â  Â  animation: spin 1s linear infinite;
Â  Â  }

Â  Â  @keyframes spin {
Â  Â  Â  to {
Â  Â  Â  Â  transform: rotate(360deg);
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  /* Modal Styles */
Â  Â  .modal {
Â  Â  Â  display: none;
Â  Â  Â  position: fixed;
Â  Â  Â  z-index: 1001;
Â  Â  Â  left: 0;
Â  Â  Â  top: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  background: rgba(0, 0, 0, 0.5);
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  }

Â  Â  .modal-content {
Â  background: linear-gradient(135deg, #00C853, #64DD17);
Â  padding: 20px;
Â  border-radius: 10px;
Â  max-width: 400px;
Â  text-align: center;
Â  color: white;
Â  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
Â  border: 2px solid white;
}


Â  Â  Â  .form-input, .btn {
Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  }
Â  Â  Â  .data-table {
Â  Â  Â  Â  font-size: 10px;
Â  Â  Â  }
Â  Â  Â  .data-table th {
Â  Â  Â  Â  padding: 4px 2px;
Â  Â  Â  Â  white-space: nowrap;
Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  text-overflow: ellipsis;
Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  vertical-align: top;
Â  Â  Â  }
Â  Â  Â  .data-table td {
Â  Â  Â  Â  padding: 4px 2px;
Â  Â  Â  Â  white-space: nowrap;
Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  text-overflow: ellipsis;
Â  Â  Â  Â  vertical-align: middle;
Â  Â  Â  }
Â  Â  Â  .data-table th:nth-child(1),
Â  Â  Â  .data-table td:nth-child(1) {
Â  Â  Â  Â  width: 25%;
Â  Â  Â  }
Â  Â  Â  .data-table th:nth-child(2),
Â  Â  Â  .data-table td:nth-child(2) {
Â  Â  Â  Â  width: 20%;
Â  Â  Â  }
Â  Â  Â  .data-table th:nth-child(3),
Â  Â  Â  .data-table td:nth-child(3) {
Â  Â  Â  Â  width: 15%;
Â  Â  Â  }
Â  Â  Â  .data-table th:nth-child(4),
Â  Â  Â  .data-table td:nth-child(4) {
Â  Â  Â  Â  width: 20%;
Â  Â  Â  }
Â  Â  Â  .data-table th:nth-child(5),
Â  Â  Â  .data-table td:nth-child(5) {
Â  Â  Â  Â  width: 20%;
Â  Â  Â  Â Â 
Â  Â  Â  }
Â  Â Â 
Â  Â  Â Â 
Â  Â  Â  .nav-btn.berkedip-kuat {
Â  animation: kedipHebat 1s infinite;
Â  background-color: #ff5252 !important;
Â  color: white !important;
Â  font-weight: bold;
Â  box-shadow: 0 0 10px #ff5252;
}
Â  Â  Â Â 
Â .berkedip-kuat {
Â  animation: kedipHebat 1s infinite;
Â  background-color: #ff5252 !important;
Â  color: white !important;
Â  font-weight: bold;
Â  border: 2px solid white !important;
Â  box-shadow: 0 0 10px #ff5252;
}

@keyframes kedipHebat {
Â  0%, 100% { opacity: 1; }
Â  50% { opacity: 0.2; }
}
Â  </style>
</head>
<body>
<div id="popupPesanan" class="modal">
Â  <div class="modal-content berkedip-kuat">
Â  Â  <h3>ðŸ“¥ Pesanan Baru Masuk!</h3>
Â  Â  <div id="popupIsiPesanan"></div>
Â  Â <button onclick="tutupPopup()" class="btn btn-primary">Lihat Pesanan Masuk</button>
Â  Â <button onclick="tutupPopup()" class="btn btn-secondary" style="margin-top: 10px;">Tutup</button>
Â  </div>
</div>

Â  <audio id="notifSound" src="https://raw.githubusercontent.com/Tabroni117/kasir-toko-buah/main/notifikasi.mp3" preload="auto" loop></audio>

Â  <div class="container">
Â  Â  <div class="header-top">
Â  <button onclick="window.location.href='dashboard.html'" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Dashboard</button>
Â  <button onclick="loadFruits()" class="btn btn-primary"><i class="fas fa-sync-alt"></i> Refresh</button>
Â  <i id="notifLonceng" class="fa-solid fa-bell" style="font-size: 20px; color: #16a34a;"></i>
</div>
Â  Â  <div class="judul"><i class="fas fa-leaf"></i> RUJAK BUAH INDONESIA</div>

Â  Â  <form id="fruitForm">
Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  <label>Nama Buah</label>
Â  Â  Â  Â  <input type="text" id="fruitName" class="form-input" required />
Â  Â  Â  </div>
Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  <label>Harga (Rp)</label>
Â  Â  Â  Â  <input type="number" id="fruitPrice" class="form-input" required />
Â  Â  Â  </div>
Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  <label>Stok (kg)</label>
Â  Â  Â  Â  <input type="number" id="fruitStock" class="form-input" required />
Â  Â  Â  </div>
Â  Â  Â  <div>
Â  Â  Â  Â  <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan</button>
Â  Â  Â  Â  <button type="reset" class="btn btn-secondary"><i class="fas fa-redo"></i> Reset</button>
Â  Â  Â  </div>
Â  Â  </form>

Â  Â  <table class="data-table">
Â  Â  Â  <thead>
Â  Â  Â  Â  <tr><th>Nama</th><th>Harga</th><th>Stok</th><th>Status</th><th>Aksi</th></tr>
Â  Â  Â  </thead>
Â  Â  Â  <tbody id="fruitList"></tbody>
Â  Â  </table>
Â  </div>

Â  <nav class="app-nav">
Â  Â  <a href="apl05.html" class="nav-btn"><i class="fas fa-home"></i> Beranda</a>
Â  Â  <a href="inventoribuah.html" class="nav-btn"><i class="fas fa-boxes"></i> Inventori</a>
Â <a href="navigator-input.html" id="navPesanan" class="nav-btn">
Â  <i class="fas fa-receipt"></i> Pesanan
</a>
Â  Â  <a href="pengaturan.html" class="nav-btn"><i class="fas fa-cog"></i> Pengaturan</a>
Â  </nav>

Â  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script>
Â  // 1. Konfigurasi Firebase
Â  const firebaseConfig = {
Â  Â  apiKey: "AIzaSyCeqHW_m9kru2vmEDVSoelZ3UWFD4k4Xqc",
Â  Â  authDomain: "tokobuahkasir.firebaseapp.com",
Â  Â  projectId: "tokobuahkasir",
Â  Â  storageBucket: "tokobuahkasir.appspot.com",
Â  Â  messagingSenderId: "731011133713",
Â  Â  appId: "1:731011133713:web:4247ae627401a01b8c1cb0"
Â  };
Â  firebase.initializeApp(firebaseConfig);
Â  const db = firebase.firestore();

Â  // 2. Utilitas format uang
Â  function formatCurrency(amount) {
Â  Â  return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(amount);
Â  }

Â  // 3. Fungsi tampilkan data buah
Â  function loadFruits() {
Â  Â  db.collection("buah").orderBy("nama").get().then(snapshot => {
Â  Â  Â  const fruitList = document.getElementById("fruitList");
Â  Â  Â  fruitList.innerHTML = '';
Â  Â  Â  if (snapshot.empty) {
Â  Â  Â  Â  fruitList.innerHTML = '<tr><td colspan="5" style="text-align:center;">Belum ada data</td></tr>';
Â  Â  Â  } else {
Â  Â  Â  Â  snapshot.forEach(doc => {
Â  Â  Â  Â  Â  const d = doc.data();
Â  Â  Â  Â  Â  fruitList.innerHTML += `
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  <td>${d.nama}</td>
Â  Â  Â  Â  Â  Â  Â  <td>${formatCurrency(d.harga)}</td>
Â  Â  Â  Â  Â  Â  Â  <td>${d.stok} kg</td>
Â  Â  Â  Â  Â  Â  Â  <td><span class="status-badge">${d.stok > 0 ? 'Ready' : 'Habis'}</span></td>
Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="editFruit('${doc.id}')" class="btn btn-secondary">Edit</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="deleteFruit('${doc.id}')" class="btn btn-primary">Hapus</button>
Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  </tr>`;
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  });
Â  }

Â  // 4. Fungsi edit data buah
Â  function editFruit(id) {
Â  Â  db.collection("buah").doc(id).get().then(doc => {
Â  Â  Â  const d = doc.data();
Â  Â  Â  fruitName.value = d.nama;
Â  Â  Â  fruitPrice.value = d.harga;
Â  Â  Â  fruitStock.value = d.stok;
Â  Â  Â  fruitForm.dataset.editId = id;
Â  Â  });
Â  }

Â  // 5. Fungsi hapus buah
Â  function deleteFruit(id) {
Â  Â  if (confirm("Hapus buah ini?")) {
Â  Â  Â  db.collection("buah").doc(id).delete().then(loadFruits);
Â  Â  }
Â  }

Â  // 6. Simpan form tambah/edit buah
Â  document.getElementById("fruitForm").addEventListener("submit", e => {
Â  Â  e.preventDefault();
Â  Â  const nama = fruitName.value;
Â  Â  const harga = parseInt(fruitPrice.value);
Â  Â  const stok = parseInt(fruitStock.value);
Â  Â  const docId = fruitForm.dataset.editId;
Â  Â  const ref = docId ? db.collection("buah").doc(docId) : db.collection("buah");
Â  Â  const data = { nama, harga, stok };
Â  Â  (docId ? ref.update(data) : ref.add(data)).then(() => {
Â  Â  Â  fruitForm.reset();
Â  Â  Â  delete fruitForm.dataset.editId;
Â  Â  Â  loadFruits();
Â  Â  });
Â  });

Â  // 7. === NOTIFIKASI PESANAN ===
Â  // Pastikan elemen-elemen ini ada di HTML Anda
Â  const popupPesanan = document.getElementById("popupPesanan");
Â  const notifLonceng = document.getElementById("notifLonceng");
Â  const navPesanan = document.getElementById("navPesanan"); // Tombol navigasi "Pesanan"
Â  const sound = document.getElementById("notifSound");
Â  let sedangBerbunyi = false;
Â  let idPesananTerbaruDitemukan = ""; 

Â  // âœ… Aktifkan suara setelah klik pertama (agar tidak diblokir browser)
Â  let audioSudahDiizinkan = false;
Â  document.addEventListener("click", () => {
Â  Â  if (!audioSudahDiizinkan) {
Â  Â  Â  sound.play().catch(() => {});
Â  Â  Â  sound.pause();
Â  Â  Â  sound.currentTime = 0;
Â  Â  Â  audioSudahDiizinkan = true;
Â  Â  }
Â  });

Â  // Fungsi untuk mengisi dan menampilkan pop-up notifikasi
Â  function tampilkanPopupPesanan(orderData, orderId) {
Â  Â  const items = orderData.items || [];
Â  Â  let isi = `<p class="font-semibold" style="font-size:14px; margin-bottom: 5px;">Order ID: ${orderId}</p>`;
Â  Â  isi += `<p style="font-size:12px; margin-bottom: 10px;">Pelanggan: ${orderData.customer?.fullName || 'Anonim'}</p>`;
Â  Â  
Â  Â  let total = 0;
Â  Â  items.forEach(item => {
Â  Â  Â  const subtotal = (item.price || 0) * (item.quantity || 0);
Â  Â  Â  total += subtotal;
Â  Â  Â  isi += `<div style="font-size:11px;">${item.name || 'Produk'} (${item.quantity || 0}x) = Rp ${subtotal.toLocaleString('id-ID')}</div>`;
Â  Â  });
Â  Â  isi += `<hr style="margin: 10px 0; border-color: rgba(255,255,255,0.3);">`;
Â  Â  isi += `<p style="font-size:14px; font-weight:bold;">Total: Rp ${(orderData.totalAmount || total).toLocaleString('id-ID')}</p>`;
Â  Â  isi += `<p style="font-size:10px; margin-top:5px;">Metode: ${orderData.paymentMethod || '-'}</p>`;
Â  Â  
Â  Â  document.getElementById("popupIsiPesanan").innerHTML = isi;
Â  Â  if (popupPesanan) popupPesanan.style.display = "flex"; // Tampilkan modal
Â  }

Â  // Fungsi untuk menutup pop-up notifikasi
Â  function tutupPopup() {
Â  Â  if (popupPesanan) popupPesanan.style.display = "none";

Â  Â  // Suara dimatikan
Â  Â  if (sound && sedangBerbunyi) {
Â  Â  Â  sound.pause();
Â  Â  Â  sound.currentTime = 0;
Â  Â  }
Â  Â  sedangBerbunyi = false;

Â  Â  // Ikon lonceng berhenti berkedip
Â  Â  if (notifLonceng) notifLonceng.classList.remove("berkedip-kuat");
Â  Â  // Navigasi Pesanan tetap berkedip sampai diklik
Â  Â  // if (navPesanan) navPesanan.classList.remove("berkedip-kuat"); // Ini dipindah ke event listener navPesanan

Â  Â  // Reset ID untuk potensi notifikasi selanjutnya
Â  Â  idPesananTerbaruDitemukan = ""; 

Â  Â  // âœ… PENTING: Panggil loadFruits() di halaman ini setelah menutup notifikasi
Â  Â  // Ini agar daftar inventori diperbarui atau tindakan lain dilakukan
Â  Â  // location.reload(); // Tidak perlu reload seluruh halaman, cukup loadFruits
Â  }

Â  // Fungsi untuk mengecek pesanan baru
Â  function cekPesananBaru() {
Â  Â  const lastNotifTimeStr = localStorage.getItem("pesananSudahDibuka"); // Menggunakan kunci ini
Â  Â  const lastNotifTime = lastNotifTimeStr ? new Date(lastNotifTimeStr) : new Date(0);

Â  Â  db.collection("pesanan").orderBy("waktu", "desc").limit(1).get().then(snapshot => {
Â  Â  Â  if (!snapshot.empty) {
Â  Â  Â  Â  const doc = snapshot.docs[0];
Â  Â  Â  Â  const orderData = doc.data();
Â  Â  Â  Â  const orderId = doc.id;
Â  Â  Â  Â  const orderTime = orderData.waktu?.toDate?.() || new Date(0); // Safely convert to Date object

Â  Â  Â  Â  // Kriteria untuk menampilkan notifikasi:
Â  Â  Â  Â  // 1. Waktu pesanan lebih baru dari waktu notifikasi terakhir yang diakui
Â  Â  Â  Â  // 2. Status pesanan masih 'Pending' (atau 'Diproses' jika Anda ingin notifikasi untuk itu juga)
Â  Â  Â  Â  // 3. ID pesanan ini belum pernah dinotifikasi di sesi ini
Â  Â  Â  Â  if (orderTime > lastNotifTime && orderData.status === 'Pending' && orderId !== idPesananTerbaruDitemukan) {
Â  Â  Â  Â  Â  idPesananTerbaruDitemukan = orderId; // Tandai pesanan ini sudah dinotifikasi di sesi ini
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  // Putar suara
Â  Â  Â  Â  Â  if (audioSudahDiizinkan && sound && !sedangBerbunyi) {
Â  Â  Â  Â  Â  Â  sound.play().catch(e => console.error("Error playing sound:", e));
Â  Â  Â  Â  Â  Â  sedangBerbunyi = true;
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  // Tampilkan pop-up notifikasi
Â  Â  Â  Â  Â  tampilkanPopupPesanan(orderData, orderId);

Â  Â  Â  Â  Â  // Tambahkan efek berkedip ke icon lonceng dan tombol pesanan
Â  Â  Â  Â  Â  if (notifLonceng) notifLonceng.classList.add("berkedip-kuat");
Â  Â  Â  Â  Â  if (navPesanan) navPesanan.classList.add("berkedip-kuat");

Â  Â  Â  Â  Â  // âœ… PENTING: Perbarui waktu notifikasi terakhir yang diakui SEGERA setelah notifikasi ini ditampilkan
Â  Â  Â  Â  Â  // Ini untuk mencegah notifikasi muncul lagi jika user langsung refresh browser
Â  Â  Â  Â  Â  localStorage.setItem("pesananSudahDibuka", new Date().toISOString());

Â  Â  Â  Â  } else if (orderTime <= lastNotifTime || orderData.status !== 'Pending') {
Â  Â  Â  Â  Â  // Jika tidak ada pesanan pending yang lebih baru, pastikan notifikasi tersembunyi
Â  Â  Â  Â  Â  // dan stop suara jika masih berbunyi
Â  Â  Â  Â  Â  if (popupPesanan && popupPesanan.style.display !== 'none') {
Â  Â  Â  Â  Â  Â  tutupPopup();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  // Jika tidak ada pesanan sama sekali, sembunyikan notifikasi
Â  Â  Â  Â  if (popupPesanan && popupPesanan.style.display !== 'none') {
Â  Â  Â  Â  Â  tutupPopup();
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }).catch(error => {
Â  Â  Â  console.error("Error checking new orders:", error);
Â  Â  Â  // Opsional: sembunyikan notifikasi jika ada error pengambilan data
Â  Â  Â  if (popupPesanan && popupPesanan.style.display !== 'none') {
Â  Â  Â  Â  tutupPopup();
Â  Â  Â  }
Â  Â  });
Â  }

Â  // 8. Jalankan saat halaman selesai dimuat
Â window.addEventListener("DOMContentLoaded", () => {
Â  loadFruits(); // Memuat data inventori
Â  cekPesananBaru(); // Memeriksa pesanan baru saat halaman dimuat
Â  setInterval(cekPesananBaru, 5000); // Memeriksa pesanan baru setiap 5 detik

Â  // âœ… Tambahkan ini: Hentikan berkedip pada tombol navigasi "Pesanan" ketika diklik
Â  document.getElementById("navPesanan").addEventListener("click", function () {
Â  Â  this.classList.remove("berkedip-kuat");
Â  Â  // Juga hentikan lonceng berkedip jika navigasi pesanan diklik
Â  Â  if (notifLonceng) notifLonceng.classList.remove("berkedip-kuat");
Â  Â  // Tidak perlu memanggil tutupPopup di sini, karena ini hanya untuk visual
Â  Â  // Kalau mau ke halaman pesanan, maka navigator-input.html yang akan mengelola
Â  });

    // Tambahkan event listener untuk tombol "Lihat Pesanan Masuk" di pop-up
    document.querySelector('#popupPesanan .btn-primary').addEventListener('click', function() {
        tutupPopup(); // Tutup popup
        window.location.href = 'navigator-input.html'; // Arahkan ke halaman pesanan
    });

    // Tambahkan event listener untuk tombol "Tutup" di pop-up
    document.querySelector('#popupPesanan .btn-secondary').addEventListener('click', function() {
        tutupPopup(); // Tutup popup
    });
});
</script>
</body>
</html>
