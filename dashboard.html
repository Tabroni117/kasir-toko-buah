<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCeqHW_m9kru2vmEDVSoelZ3UWFD4k4Xqc",
    authDomain: "tokobuahkasir.firebaseapp.com",
    projectId: "tokobuahkasir",
    storageBucket: "tokobuahkasir.appspot.com",
    messagingSenderId: "731011133713",
    appId: "1:731011133713:web:4247ae627401a01b8c1cb0",
    measurementId: "G-7CPE2DB2BV"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const buahRef = collection(db, "buah");

  async function loadData() {
    const snapshot = await getDocs(buahRef);
    const table = document.getElementById("buahTable");
    table.innerHTML = "";
    snapshot.forEach((docSnap) => {
      const data = docSnap.data();
      const row = document.createElement("tr");

      row.innerHTML = `
        <td><input value="${data.nama}" onchange="editField('${docSnap.id}', 'nama', this.value)"/></td>
        <td><input type="number" value="${data.harga}" onchange="editField('${docSnap.id}', 'harga', this.value)"/></td>
        <td><input type="number" value="${data.stok}" onchange="editField('${docSnap.id}', 'stok', this.value)"/></td>
        <td><button onclick="hapusBuah('${docSnap.id}')">Hapus</button></td>
      `;
      table.appendChild(row);
    });
  }

  window.tambahBuah = async function () {
    const nama = document.getElementById("newName").value.trim();
    const harga = parseInt(document.getElementById("newPrice").value);
    const stok = parseInt(document.getElementById("newStock").value);
    if (nama && !isNaN(harga) && !isNaN(stok)) {
      await addDoc(buahRef, { nama, harga, stok });
      document.getElementById("newName").value = "";
      document.getElementById("newPrice").value = "";
      document.getElementById("newStock").value = "";
      loadData();
    } else {
      alert("Isi semua kolom!");
    }
  };

  window.editField = async function (id, field, value) {
    if (field !== "nama") value = parseInt(value);
    const buahDoc = doc(db, "buah", id);
    await updateDoc(buahDoc, { [field]: value });
  };

  window.hapusBuah = async function (id) {
    if (confirm("Hapus buah ini?")) {
      const buahDoc = doc(db, "buah", id);
      await deleteDoc(buahDoc);
      loadData();
    }
  };

  loadData();
</script>
