<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rujak Buah Indonesia - Aplikasi Pelanggan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <style>
        /* General Styling */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: #f9f9f9;
            color: #333;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
            /* Adjusted: bottom-nav height (50px) + floatingCartBar height (45px) + a little margin (10px) = 105px */
            padding-bottom: 105px; 
        }

        /* Header Styling */
        .header {
            background: linear-gradient(135deg, #00C853, #64DD17);
            color: white;
            padding: 12px 16px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .header-top-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 8px;
        }

        .app-header {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .app-title {
            font-weight: bold;
            font-size: 20px;
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }

        .leaf-icon {
            margin-right: 10px;
            font-size: 24px;
        }
        
        .app-tagline {
            font-size: 12px;
            font-style: italic;
            color: rgba(255,255,255,0.9);
        }

        /* Logout Button Style */
        .logout-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s, border-color 0.3s;
            margin-left: auto;
            white-space: nowrap;
        }
        .logout-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .address-bar {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 8px;
            padding: 10px;
            position: relative;
            width: 100%;
        }

        .gps-icon {
            color: #00C853;
            margin-right: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .gps-icon.loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        .delivery-input {
            flex-grow: 1;
            border: none;
            outline: none;
            font-size: 14px;
            color: #333;
        }

        .location-placeholder {
            color: #999;
        }

        /* Promo Banner */
        .promo-banner {
            padding: 16px;
            overflow: hidden;
            position: relative;
            background: white;
            margin-bottom: 8px;
        }
        
        .promo-slides-container {
            display: flex;
            gap: 12px;
            transition: transform 0.5s ease;
            white-space: nowrap;
            /* Added for horizontal scrolling behavior */
            overflow-x: auto; 
            -webkit-overflow-scrolling: touch; /* For smoother scrolling on iOS */
            scroll-snap-type: x mandatory; /* For snapping behavior */
        }

        .promo-banner::-webkit-scrollbar {
            display: none;
        }

        .promo-slide {
            min-width: 200px;
            height: 100px;
            border-radius: 8px;
            background: linear-gradient(135deg, #00C853, #64DD17);
            color: white;
            padding: 12px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            scroll-snap-align: start;
            box-shadow:
                2px 2px 3px rgba(22, 163, 74, 0.5),
                4px 4px 4px rgba(22, 163, 74, 0.6),
                6px 6px 5px rgba(22, 163, 74, 0.7);
            transition: box-shadow 0.2s ease, transform 0.2s ease;
        }

        .promo-slide:hover {
            box-shadow:
                2px 2px 4px rgba(22, 163, 74, 0.6),
                4px 4px 6px rgba(22, 163, 74, 0.7),
                6px 6px 8px rgba(22, 163, 74, 0.8);
            transform: translateY(-3px);
        }

        .promo-title {
            font-size: 14px;
            font-weight: bold;
        }

        .promo-desc {
            font-size: 12px;
        }

        /* Categories */
        .categories {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 16px;
            background: white;
            margin-bottom: 8px;
        }

        .category {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            background:#ffffff;
            border-radius: 12px;
            transition: transform 0.2s ease;
            cursor: pointer;
        }

        .category:hover {
            transform: translateY(-2px);
        }
        
        .category-icon {
            background: #3ee36f;
            color: #ffffff;
            border-radius: 10px;
            border-bottom: 2px solid #15803d;
            border-right: 2px solid #15803d;
            box-shadow: 2px 2px 5px rgba(0, 128, 0, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            font-size: 18px;
            padding: 14px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .category:hover .category-icon,
        .category.active .category-icon {
            background: #3ee36f;
            color: #ffffff;
            transform: scale(1.1);
            box-shadow: 0 0 14px 6px rgba(253, 224, 71, 0.5);
            animation: softGlow 1.8s ease-in-out infinite alternate;
        }

        @keyframes softGlow {
            from {
                box-shadow: 0 0 10px 3px rgba(253, 224, 71, 0.3);
            }
            to {
                box-shadow: 0 0 14px 5px rgba(253, 224, 71, 0.6);
            }
        }

        .category-name {
            font-size: 12px;
            font-weight: 600;
            color: #22c55e;
            text-align: center;
            line-height: 1.2;
        }

        @keyframes spinIcon {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .category-icon i.rotating {
            animation: spinIcon 2s linear infinite;
        }

        /* Menu Section */
        .section-title {
            padding: 16px 16px 8px;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .see-all {
            font-size: 12px;
            color: #00C853;
            font-weight: normal;
        }

        .restaurants {
            padding: 0 16px 16px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .restaurant-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s;
            position: relative; /* Essential for positioning the button */
        }

        .restaurant-card:hover {
            transform: translateY(-3px);
        }

        .restaurant-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            object-position: center 70%;
            border-radius: 8px 8px 0 0;
        }

        .restaurant-info {
            padding: 10px;
        }

        .restaurant-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .restaurant-meta {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #757575;
        }

        .rating {
            color: #FFD700;
        }

        .delivery-time {
            color: #00C853;
        }

        /* NEW: Add to Cart/Quantity Control on Menu Card */
        .add-to-cart-control {
            position: absolute;
            bottom: 8px;
            right: 8px;
            z-index: 10;
        }

        .add-button {
            background-color: #22c55e; /* Bright green */
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.2s, transform 0.2s;
        }

        .add-button:hover {
            background-color: #16a34a; /* Darker green on hover */
            transform: scale(1.05);
        }

        /* Quantity display when item is in cart */
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 5px; /* Small gap between buttons and quantity */
            background-color: #22c55e;
            border-radius: 20px;
            padding: 4px 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .quantity-control button {
            background-color: transparent;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        .quantity-control .quantity-display {
            color: white;
            font-size: 14px;
            font-weight: bold;
            min-width: 20px; /* Adjust as needed */
            text-align: center;
        }


        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 480px;
            display: flex;
            justify-content: space-around;
            background: linear-gradient(135deg, #00C853, #64DD17);
            padding: 6px 0;
            border-top: 1px solid rgba(255,255,255,0.2);
            z-index: 1000;
            height: 50px;
            left: 50%; /* Center the nav */
            transform: translateX(-50%); /* Center the nav */
        }

        .nav-item {
            text-align: center;
            color: rgba(255,255,255,0.7);
            font-size: 10px;
            padding: 4px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex; /* Make it flex to align icon and text */
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .nav-item.active {
            color: white;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
            color: white;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        /* Loading message for menu list */
        .menu-loading-message {
            text-align: center;
            padding: 20px;
            color: #757575;
            font-size: 1.1em;
        }

        /* Cart Badge on Bottom Nav */
        .cart-badge {
            position: absolute;
            top: 0;
            right: 0;
            transform: translate(30%, -30%);
            background-color: #ef4444; /* red */
            color: white;
            font-size: 10px;
            font-weight: bold;
            border-radius: 999px;
            padding: 2px 6px;
            min-width: 16px;
            text-align: center;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        /* Floating Cart Bar */
        #floatingCartBar {
            position: fixed;
            bottom: 50px; /* Right above bottom-nav (50px height) */
            left: 50%;
            transform: translateX(-50%);
            max-width: 480px;
            width: 100%;
            z-index: 999; /* Lowered z-index slightly to differentiate from popup */
            background: #22c55e; /* Green as requested */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 16px;
            border-top: 1px solid #16a34a;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
            height: 45px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            /* Initially hidden */
            display: none; 
            opacity: 0;
            transform: translateX(-50%) translateY(20px); /* Start slightly lower */
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }
        #floatingCartBar.show {
            display: flex;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        #floatingCartBar .cart-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #floatingCartBar .cart-button {
            color: white;
            font-size: 1.2em;
        }

        #floatingCartBar .cart-text {
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        #floatingCartBar .checkout-button {
            background-color: #fde047; /* Yellow */
            color: black;
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #floatingCartBar .checkout-button:hover {
            background-color: #facc15; /* Darker yellow on hover */
        }

        /* Popup Panel */
        #popupPanel {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.3);
            display: none; /* Controlled by JS */
            justify-content: center;
            align-items: flex-end; /* Appears from bottom */
            z-index: 9999;
        }

        #popupPanel.show {
            display: flex;
        }

        .popup-content {
            width: 100%;
            max-width: 480px; /* Match container width */
            height: 85vh;
            background-color: white;
            border-top-left-radius: 18px;
            border-top-right-radius: 18px;
            overflow: hidden;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            animation: slideUp 0.35s ease-out forwards;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0%); }
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 16px;
            border-bottom: 1px solid #eee;
            background-color: #f8f8f8;
            font-weight: bold;
        }

        .close-popup-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #555;
            padding: 0 5px;
        }

        #popupFrame {
            flex: 1;
            width: 100%;
            border: none;
        }

        /* Hidden checkout bar inside popup - this will be handled by the cart page itself */
        #popupCheckoutBar {
            display: none !important; 
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-top-row">
                <div class="app-header">
                    <div class="app-title">
                        <i class="fas fa-leaf leaf-icon"></i>Rujak Buah Indonesia
                    </div>
                    <div class="app-tagline">Segar, Sehat, Cepat Sampai!</div>
                </div>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>
            <div class="address-bar">
                <i class="fas fa-map-marker-alt gps-icon" id="gpsIcon"></i>
                <input type="text" class="delivery-input" id="deliveryAddress" placeholder="Lokasi pengiriman Anda" readonly>
            </div>
        </header>

        <section class="promo-banner">
            <div class="promo-slides-container">
                <div class="promo-slide">
                    <div class="promo-title">Diskon 10%</div>
                    <div class="promo-desc">Untuk pembelian pertama!</div>
                </div>
                <div class="promo-slide">
                    <div class="promo-title">Gratis Ongkir</div>
                    <div class="promo-desc">Min. belanja Rp 50.000</div>
                </div>
                <div class="promo-slide">
                    <div class="promo-title">Cashback 5%</div>
                    <div class="promo-desc">Dengan GoPay/OVO</div>
                </div>
            </div>
        </section>

        <section class="categories-section">
            <div class="section-title">Kategori</div>
            <div class="categories">
                <div class="category" data-category="rujak-buah">
                    <div class="category-icon"><i class="fas fa-apple-alt"></i></div>
                    <div class="category-name">Rujak Buah</div>
                </div>
                <div class="category" data-category="asinan">
                    <div class="category-icon"><i class="fas fa-carrot"></i></div>
                    <div class="category-name">Asinan</div>
                </div>
                <div class="category" data-category="es-buah">
                    <div class="category-icon"><i class="fas fa-ice-cream"></i></div>
                    <div class="category-name">Es Buah</div>
                </div>
                <div class="category" data-category="lainnya">
                    <div class="category-icon"><i class="fas fa-utensils"></i></div>
                    <div class="category-name">Lainnya</div>
                </div>
            </div>
        </section>

        <section class="menu-section">
            <div class="section-title">
                Menu Populer
                <a href="#" class="see-all">Lihat Semua</a>
            </div>
            <div class="restaurants" id="menuList">
                <div class="restaurant-card" data-item-id="rujak-spesial-1">
                    <img src="https://via.placeholder.com/150/00C853/FFFFFF?text=Rujak+Spesial" alt="Rujak Spesial" class="restaurant-image">
                    <div class="restaurant-info">
                        <div class="restaurant-name">Rujak Spesial Komplit</div>
                        <div class="restaurant-meta">
                            <span class="rating"><i class="fas fa-star"></i> 4.8</span>
                            <span class="delivery-time">25-35 min</span>
                        </div>
                        <div class="price">Rp 25.000</div>
                        <div class="add-to-cart-control">
                            <button class="add-button" data-item-id="rujak-spesial-1"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>
                </div>

                <div class="restaurant-card" data-item-id="es-buah-segar-2">
                    <img src="https://via.placeholder.com/150/64DD17/FFFFFF?text=Es+Buah+Segar" alt="Es Buah Segar" class="restaurant-image">
                    <div class="restaurant-info">
                        <div class="restaurant-name">Es Buah Segar</div>
                        <div class="restaurant-meta">
                            <span class="rating"><i class="fas fa-star"></i> 4.5</span>
                            <span class="delivery-time">15-20 min</span>
                        </div>
                        <div class="price">Rp 20.000</div>
                        <div class="add-to-cart-control">
                            <button class="add-button" data-item-id="es-buah-segar-2"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>
                </div>
                
                <div class="restaurant-card" data-item-id="asinan-jakarta-3">
                    <img src="https://via.placeholder.com/150/00C853/FFFFFF?text=Asinan+Jakarta" alt="Asinan Jakarta" class="restaurant-image">
                    <div class="restaurant-info">
                        <div class="restaurant-name">Asinan Sayur Jakarta</div>
                        <div class="restaurant-meta">
                            <span class="rating"><i class="fas fa-star"></i> 4.7</span>
                            <span class="delivery-time">20-30 min</span>
                        </div>
                        <div class="price">Rp 18.000</div>
                        <div class="add-to-cart-control">
                            <button class="add-button" data-item-id="asinan-jakarta-3"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>
                </div>

                <div class="restaurant-card" data-item-id="rujak-serut-4">
                    <img src="https://via.placeholder.com/150/64DD17/FFFFFF?text=Rujak+Serut" alt="Rujak Serut" class="restaurant-image">
                    <div class="restaurant-info">
                        <div class="restaurant-name">Rujak Serut Pedas</div>
                        <div class="restaurant-meta">
                            <span class="rating"><i class="fas fa-star"></i> 4.6</span>
                            <span class="delivery-time">25-30 min</span>
                        </div>
                        <div class="price">Rp 22.000</div>
                        <div class="add-to-cart-control">
                            <button class="add-button" data-item-id="rujak-serut-4"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="menu-loading-message" style="display: none;">Memuat menu...</div>
        </section>

    </div>

    <div id="floatingCartBar">
        <div class="cart-info">
            <span class="cart-button"><i class="fas fa-shopping-cart"></i></span>
            <span class="cart-text" id="floatingCartItemCount">0 item</span>
        </div>
        <div class="cart-text" id="floatingCartTotalPrice">Rp 0</div>
        <button class="checkout-button" id="floatingCheckoutBtn">Checkout</button>
    </div>

    <nav class="bottom-nav">
        <a href="#" class="nav-item active">
            <i class="fas fa-home nav-icon"></i>
            <span>Beranda</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-history nav-icon"></i>
            <span>Pesanan</span>
        </a>
        <a href="#" class="nav-item" id="navCartItem">
            <i class="fas fa-shopping-cart nav-icon"></i>
            <span class="cart-badge" id="navCartBadge" style="display: none;">0</span>
            <span>Keranjang</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-user nav-icon"></i>
            <span>Akun</span>
        </a>
    </nav>

    <div id="popupPanel">
        <div class="popup-content">
            <div class="popup-header">
                <span id="popupTitle">Keranjang Belanja</span>
                <button class="close-popup-btn" id="closePopupBtn">&times;</button>
            </div>
            <iframe id="popupFrame" src="about:blank"></iframe>
        </div>
    </div>

    <script>
        // Firebase Configuration (Ganti dengan konfigurasi Firebase Anda yang sebenarnya)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Dummy Cart Data
        let cart = {}; // { itemId: quantity }

        // --- DOM Elements ---
        const floatingCartBar = document.getElementById('floatingCartBar');
        const floatingCartItemCount = document.getElementById('floatingCartItemCount');
        const floatingCartTotalPrice = document.getElementById('floatingCartTotalPrice');
        const floatingCheckoutBtn = document.getElementById('floatingCheckoutBtn');
        const navCartBadge = document.getElementById('navCartBadge');
        const navCartItem = document.getElementById('navCartItem');
        const popupPanel = document.getElementById('popupPanel');
        const closePopupBtn = document.getElementById('closePopupBtn');
        const popupFrame = document.getElementById('popupFrame');
        const menuList = document.getElementById('menuList'); // The container for restaurant-cards

        // --- Functions ---

        // Function to update cart display
        function updateCartDisplay() {
            let totalItems = 0;
            let totalPrice = 0;

            // Define dummy menu items with prices for calculation
            const menuItems = {
                "rujak-spesial-1": { price: 25000 },
                "es-buah-segar-2": { price: 20000 },
                "asinan-jakarta-3": { price: 18000 },
                "rujak-serut-4": { price: 22000 }
                // Add all your menu items here with their respective prices
            };

            for (const itemId in cart) {
                const quantity = cart[itemId];
                totalItems += quantity;
                if (menuItems[itemId]) {
                    totalPrice += quantity * menuItems[itemId].price;
                }
                
                // Update quantity control on each card
                const card = document.querySelector(`.restaurant-card[data-item-id="${itemId}"]`);
                if (card) {
                    let controlElement = card.querySelector('.add-to-cart-control');
                    if (controlElement) {
                        if (quantity > 0) {
                            controlElement.innerHTML = `
                                <div class="quantity-control">
                                    <button class="remove-button" data-item-id="${itemId}"><i class="fas fa-minus"></i></button>
                                    <span class="quantity-display">${quantity}</span>
                                    <button class="add-button" data-item-id="${itemId}"><i class="fas fa-plus"></i></button>
                                </div>
                            `;
                        } else {
                            controlElement.innerHTML = `
                                <button class="add-button" data-item-id="${itemId}"><i class="fas fa-plus"></i></button>
                            `;
                            delete cart[itemId]; // Remove item from cart if quantity is 0
                        }
                    }
                }
            }

            // Update floating cart bar
            if (totalItems > 0) {
                floatingCartItemCount.textContent = `${totalItems} item`;
                floatingCartTotalPrice.textContent = `Rp ${totalPrice.toLocaleString('id-ID')}`;
                floatingCartBar.classList.add('show');
            } else {
                floatingCartBar.classList.remove('show');
            }

            // Update bottom nav cart badge
            if (totalItems > 0) {
                navCartBadge.textContent = totalItems;
                navCartBadge.style.display = 'block';
            } else {
                navCartBadge.style.display = 'none';
            }
        }

        // Function to add item to cart
        function addItemToCart(itemId) {
            cart[itemId] = (cart[itemId] || 0) + 1;
            updateCartDisplay();
        }

        // Function to remove item from cart
        function removeItemFromCart(itemId) {
            if (cart[itemId] && cart[itemId] > 0) {
                cart[itemId]--;
                updateCartDisplay();
            }
        }

        // --- Event Listeners ---

        // Handle clicks on add/remove buttons
        menuList.addEventListener('click', (event) => {
            const button = event.target.closest('.add-button, .remove-button');
            if (button) {
                const itemId = button.dataset.itemId;
                if (button.classList.contains('add-button')) {
                    addItemToCart(itemId);
                } else if (button.classList.contains('remove-button')) {
                    removeItemFromCart(itemId);
                }
            }
        });

        // Open popup for cart/checkout
        floatingCartBar.addEventListener('click', () => {
            // In a real app, this would load a cart page
            popupFrame.src = 'cart.html'; // Or load dynamic content
            popupPanel.classList.add('show');
        });

        navCartItem.addEventListener('click', (e) => {
            e.preventDefault(); // Prevent default link behavior
            popupFrame.src = 'cart.html'; // Or load dynamic content
            popupPanel.classList.add('show');
        });

        // Close popup
        closePopupBtn.addEventListener('click', () => {
            popupPanel.classList.remove('show');
            popupFrame.src = 'about:blank'; // Clear iframe content
        });

        // Close popup when clicking outside (on overlay)
        popupPanel.addEventListener('click', (e) => {
            if (e.target === popupPanel) {
                popupPanel.classList.remove('show');
                popupFrame.src = 'about:blank'; // Clear iframe content
            }
        });

        // Dummy Logout Function (needs proper Firebase Auth implementation)
        document.getElementById('logoutBtn').addEventListener('click', () => {
            // For a real app, use firebase.auth().signOut()
            alert('Anda telah logout (fungsi dummy)');
            // Redirect to login page or update UI
        });

        // Dummy GPS Function
        document.getElementById('gpsIcon').addEventListener('click', () => {
            const gpsIcon = document.getElementById('gpsIcon');
            gpsIcon.classList.add('loading');
            document.getElementById('deliveryAddress').placeholder = 'Mencari lokasi...';

            setTimeout(() => {
                document.getElementById('deliveryAddress').value = 'Jl. Kebon Jeruk Raya No. 123, Jakarta Barat';
                document.getElementById('deliveryAddress').placeholder = ''; // Clear placeholder once address is set
                gpsIcon.classList.remove('loading');
            }, 2000); // Simulate 2-second loading
        });

        // Initial update when page loads
        updateCartDisplay();
    </script>
</body>
</html>
